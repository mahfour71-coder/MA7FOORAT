<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>المفضلة - MAHFOOR CNC</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="mobile.css" media="(max-width: 768px)">
    <style>
        :root {
            --wood-dark: #7c5e42;
            --wood-light: #d9c8a9;
            --nature-green: #13352f;
            --cream-bg: #f5f0e8;
            --white: #FFFFFF;
            --shadow: rgba(107, 79, 75, 0.15);
            --accent-gold: #ff9800;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: linear-gradient(to bottom, #7c5e42, #d9c8a9); color: #444; min-height: 100vh; padding: 20px 10px; background-attachment: fixed; }
        .favorites-container { max-width: 900px; margin: 0 auto; background: var(--white); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px var(--shadow); }
        .header-bar { background: linear-gradient(135deg, var(--wood-dark) 0%, #6d4c41 100%); padding: 15px 30px; color: white; text-align: center; border-bottom: 4px solid var(--wood-light); }
        .header-bar h1 { margin: 0; font-family: 'Amiri', serif; font-size: 1.8em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .favorites-content { padding: 30px; }
        .favorites-items { margin-bottom: 25px; }
        .favorite-item { display: flex; align-items: center; background: var(--white); border-radius: 15px; padding: 18px; margin-bottom: 18px; border: 1px solid #E0D4B5; transition: all 0.3s ease; }
        .favorite-item:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }
        .item-image { width: 90px; height: 90px; border-radius: 12px; object-fit: cover; margin-left: 25px; border: 2px solid var(--wood-light); }
        .item-details { flex: 1; padding: 0 15px; }
        .item-details h3 { color: var(--wood-dark); font-size: 1.3em; margin-bottom: 6px; font-weight: 600; cursor: pointer; }
        .item-details .price { color: var(--wood-dark); font-weight: 800; font-size: 1.2em; margin: 8px 0; }
        .remove-btn { background: transparent; color: #D9534F; border: none; width: 38px; height: 38px; border-radius: 50%; font-size: 1.6em; cursor: pointer; transition: all 0.3s; margin-right: 10px; }
        .remove-btn:hover { background: #FBEAE9; transform: scale(1.1); }
        .move-to-cart-btn { background: transparent; border: none; color: #4CAF50; font-size: 1.5em; cursor: pointer; transition: all 0.3s ease; padding: 5px; }
        .move-to-cart-btn:hover { color: #45a049; transform: scale(1.2); }
        .action-buttons { display: flex; gap: 15px; margin-top: 20px; }
        .btn { flex: 1; padding: 16px; font-size: 1.2em; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .continue-shopping { background: var(--wood-light); color: var(--wood-dark); border: 2px solid var(--wood-dark) !important; }
        .continue-shopping:hover { background: var(--wood-dark); color: white; }
        .clear-favorites-btn { background: #D9534F; color: white; }
        .clear-favorites-btn:hover { background: #c9302c; }
        .empty-favorites { text-align: center; padding: 60px 20px; color: var(--wood-dark); font-size: 1.3em; }
        .empty-favorites i { font-size: 4em; margin-bottom: 20px; opacity: 0.3; }
    </style>
</head>
<body>

<div class="favorites-container">
    <div class="header-bar">
        <h1><i class="fas fa-heart"></i> قائمة المفضلة</h1>
    </div>

    <div class="favorites-content">
        <div class="favorites-items">
            <!-- المنتجات المفضلة تُضاف هنا -->
        </div>

        <div class="action-buttons">
            <button class="btn continue-shopping" onclick="window.location.href='index.html'">متابعة التسوق</button>
            <button class="btn clear-favorites-btn" onclick="clearFavoritesWithConfirmation()">مسح المفضلة</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // تحميل المفضلة من localStorage
    let favorites = JSON.parse(localStorage.getItem('mahfourFavorites')) || [];

    function renderFavorites() {
        const favoritesItems = document.querySelector('.favorites-items');
        favoritesItems.innerHTML = '';

        if (favorites.length === 0) {
            favoritesItems.innerHTML = `
                <div class="empty-favorites">
                    <i class="far fa-heart"></i>
                    <p>قائمة المفضلة فارغة</p>
                    <p style="font-size: 0.9em; margin-top: 10px; color: #777;">
                        أضف المنتجات التي تحبها لتبقى على اطلاع بها.
                    </p>
                </div>`;
            return;
        }

        favorites.forEach((item, index) => {
            const price = parseFloat(item.price);
            const div = document.createElement('div');
            div.className = 'favorite-item';
            div.innerHTML = `
                <img src="${item.img || 'https://via.placeholder.com/90?text=خشب'}" alt="${item.name}" class="item-image">
                <div class="item-details">
                    <h3 onclick="window.location.href='product-details.html?id=${item.id}'">${item.name}</h3>
                    <p class="price">${price.toFixed(2)} جنيه</p>
                </div>
                <button class="move-to-cart-btn" onclick="moveItemToCart(${index})" title="نقل إلى السلة"><i class="fas fa-cart-plus"></i></button>
                <button class="remove-btn" onclick="removeItem(${index})" title="إزالة من المفضلة"><i class="fas fa-trash-alt"></i></button>
            `;
            favoritesItems.appendChild(div);
        });
        localStorage.setItem('mahfourFavorites', JSON.stringify(favorites));
    }

    function removeItem(index) {
        Swal.fire({
            title: 'هل أنت متأكد؟',
            text: "سيتم حذف هذا المنتج من المفضلة!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#7c5e42',
            cancelButtonColor: '#d33',
            confirmButtonText: 'نعم، احذفه!',
            cancelButtonText: 'إلغاء'
        }).then((result) => {
            if (result.isConfirmed) {
                favorites.splice(index, 1);
                localStorage.setItem('mahfourFavorites', JSON.stringify(favorites));
                renderFavorites();
                updateFavoritesCount();
                Swal.fire('تم الحذف!', 'تم حذف المنتج من المفضلة.', 'success');
            }
        });
    }

    function moveItemToCart(index) {
        const itemToMove = favorites[index];
        if (!itemToMove) return;

        let cart = JSON.parse(localStorage.getItem('mahfoor_cart')) || [];
        const productData = productsData.find(p => p.id === itemToMove.id);

        if (productData && productData.available) {
            const existingInCart = cart.find(cartItem => cartItem.id === itemToMove.id);
            if (existingInCart) {
                existingInCart.qty++;
            } else {
                cart.push({
                    id: productData.id,
                    name: productData.name,
                    code: productData.code,
                    price: parseFloat(itemToMove.price),
                    qty: 1,
                    image: productData.img
                });
            }
            localStorage.setItem('mahfoor_cart', JSON.stringify(cart));
            cartData = cart; // تحديث المتغير العام لضمان تحديث العداد

            // إزالة المنتج من المفضلة
            favorites.splice(index, 1);
            localStorage.setItem('mahfourFavorites', JSON.stringify(favorites));

            // إعادة رسم وتحديث العدادات
            renderFavorites();
            updateCartCount();
            updateFavoritesCount();

            Swal.fire({
                icon: 'success',
                title: 'تم النقل!',
                text: `تم نقل "${itemToMove.name}" إلى سلة المشتريات.`,
                timer: 2000,
                showConfirmButton: false
            });
        } else {
            Swal.fire('منتج غير متوفر', 'عذراً، هذا المنتج غير متوفر حالياً.', 'warning');
        }
    }

    function clearFavoritesWithConfirmation() {
        if (favorites.length === 0) return;
        Swal.fire({
            title: 'هل أنت متأكد؟',
            text: "سيتم حذف جميع المنتجات من المفضلة!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'نعم، امسح الكل!',
            cancelButtonText: 'إلغاء'
        }).then((result) => {
            if (result.isConfirmed) {
                favorites = [];
                localStorage.setItem('mahfourFavorites', JSON.stringify(favorites));
                renderFavorites();
                updateFavoritesCount();
                Swal.fire('تم المسح!', 'أصبحت قائمة مفضلتك فارغة الآن.', 'success');
            }
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        renderFavorites();
        // استدعاء الدوال من script.js لتحديث العدادات عند تحميل الصفحة
        // هذه الدوال موجودة بالفعل في initialize() في script.js
        updateCartCount();
        updateFavoritesCount();
    });
</script>

</body>
</html>